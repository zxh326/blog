<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#494f5c"><meta name=msapplication-TileColor content="#494f5c"><meta itemprop=name content="Go中的channel详解"><meta itemprop=description content="Channel是Go中的一个核心类型，你可以把它看成一个管道，通过它并发核心单元就可以发送或者接收数据进行通讯(communication)"><meta itemprop=datePublished content="2019-01-13T15:04:33+08:00"><meta itemprop=dateModified content="2019-01-13T15:04:33+08:00"><meta itemprop=wordCount content="3728"><meta itemprop=keywords content="Go,"><meta property="og:title" content="Go中的channel详解"><meta property="og:description" content="Channel是Go中的一个核心类型，你可以把它看成一个管道，通过它并发核心单元就可以发送或者接收数据进行通讯(communication)"><meta property="og:type" content="article"><meta property="og:url" content="https://zzde.me/posts/go-channel-detail/"><meta property="article:published_time" content="2019-01-13T15:04:33+08:00"><meta property="article:modified_time" content="2019-01-13T15:04:33+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go中的channel详解"><meta name=twitter:description content="Channel是Go中的一个核心类型，你可以把它看成一个管道，通过它并发核心单元就可以发送或者接收数据进行通讯(communication)"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>Go中的channel详解</title><link rel=stylesheet href=https://zzde.me/css/style.min.657bcb7af31123e4156b1a3d2ff60a636717e54ead74f882136b5114cf72b55e.css integrity="sha256-ZXvLevMRI+QVaxo9L/YKY2cX5U6tdPiCE2tRFM9ytV4=" crossorigin=anonymous><link rel=stylesheet href=https://zzde.me/css/custom.scss><link rel=stylesheet href=https://zzde.me/css/style.scss></head><body id=page><header id=site-header class="animated slideInUp faster"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://zzde.me/>Zzde's blog</a></div><nav class="site-nav hide-in-mobile"><a href=https://zzde.me/posts/>Posts</a>
<a href=https://zzde.me/about-hugo/>About</a></nav></div><div class="hdr-right hdr-icons"><span class="hdr-social hide-in-mobile"><a href=https://twitter.com/m_zzde target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://instagram.com/zzde.me target=_blank rel="noopener me" title=Instagram><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"/><line x1="17.5" y1="6.5" x2="17.5" y2="6.5"/></svg></a><a href=https://github.com/zxh326 target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://zzde.me/posts/>Posts</a></li><li><a href=https://zzde.me/about-hugo/>About</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Jan 13, 2019</span></div><h1>Go中的channel详解</h1></header><div class=content><p>Channel是Go中的一个核心类型，你可以把它看成一个管道，通过它并发核心单元就可以发送或者接收数据进行通讯(communication)。</p><p>它的操作符是箭头 <strong>&lt;-</strong> 。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=nx>ch</span> <span class=o>&lt;-</span> <span class=nx>v</span>    <span class=c1>// 发送值v到Channel ch中
</span><span class=c1></span>
<span class=nx>v</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>ch</span>  <span class=c1>// 从Channel ch中接收数据，并将数据赋值给v
</span></code></pre></div><p>(箭头的指向就是数据的流向)</p><p>就像 map 和 slice 数据类型一样, channel必须先创建再使用:
<code>ch := make(chan int)</code></p><h3 id=channel类型>Channel类型<a href=#channel类型 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><hr><p>Channel类型的定义格式如下：</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>ChannelType = ( &#34;chan&#34; | &#34;chan&#34; &#34;&lt;-&#34; | &#34;&lt;-&#34; &#34;chan&#34; ) ElementType .
</code></pre></div><p>它包括三种类型的定义。可选的<code>&lt;-</code>代表channel的方向。如果没有指定方向，那么Channel就是双向的，既可以接收数据，也可以发送数据。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kd>chan</span> <span class=nx>T</span>          <span class=c1>// 可以接收和发送类型为 T 的数据
</span><span class=c1></span>
<span class=kd>chan</span><span class=o>&lt;-</span> <span class=kt>float64</span>  <span class=c1>// 只可以用来发送 float64 类型的数据
</span><span class=c1></span>
<span class=o>&lt;-</span><span class=kd>chan</span> <span class=kt>int</span>      <span class=c1>// 只可以用来接收 int 类型的数据
</span></code></pre></div><p><code>&lt;-</code>总是优先和最左边的类型结合。(The &lt;- operator associates with the leftmost chan possible)</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kd>chan</span><span class=o>&lt;-</span> <span class=kd>chan</span> <span class=kt>int</span>    <span class=c1>// 等价 chan&lt;- (chan int)
</span><span class=c1></span>
<span class=kd>chan</span><span class=o>&lt;-</span> <span class=o>&lt;-</span><span class=kd>chan</span> <span class=kt>int</span>  <span class=c1>// 等价 chan&lt;- (&lt;-chan int)
</span><span class=c1></span>
<span class=o>&lt;-</span><span class=kd>chan</span> <span class=o>&lt;-</span><span class=kd>chan</span> <span class=kt>int</span>  <span class=c1>// 等价 &lt;-chan (&lt;-chan int)
</span><span class=c1></span>
<span class=kd>chan</span> <span class=p>(</span><span class=o>&lt;-</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span>
</code></pre></div><p>使用<code>make</code>初始化Channel,并且可以设置容量:</p><p><code>make(chan int, 100)</code></p><p>容量(capacity)代表Channel容纳的<strong>最多的元素</strong>的数量，代表Channel的缓存的大小。<br>如果没有设置容量，或者容量设置为0, 说明Channel没有缓存，只有sender和receiver都准备好了后它们的通讯(communication)才会发生(Blocking)。
如果设置了缓存，就有可能不发生阻塞， 只有buffer满了后 send才会阻塞， 而只有缓存空了后receive才会阻塞。一个nil channel不会通信。</p><p>可以通过内建的<code>close</code>方法可以关闭Channel。</p><p>你可以在多个goroutine从/往 一个channel 中 receive/send 数据, 不必考虑额外的同步措施。</p><p>Channel可以作为一个先入先出(FIFO)的队列，接收的数据和发送的数据的顺序是一致的。</p><p>channel的 receive支持 <em>multi-valued assignment</em>，如</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=nx>v</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>ch</span>
</code></pre></div><p>它可以用来检查Channel是否已经被关闭了。</p><h3 id=send语句>send语句<a href=#send语句 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><hr><p>send语句用来往Channel中发送数据， 如<code>ch &lt;- 3</code>。<br>它的定义如下:</p><p>SendStmt = Channel &ldquo;&lt;-&rdquo; Expression .</p><p>Channel = Expression .</p><p>在通讯(communication)开始前channel和expression必选先求值出来(evaluated)，比如下面的(3+4)先计算出7然后再发送给channel。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=nx>c</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span>

<span class=k>defer</span> <span class=nb>close</span><span class=p>(</span><span class=nx>c</span><span class=p>)</span>

<span class=k>go</span> <span class=kd>func</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span> <span class=nx>c</span> <span class=o>&lt;-</span> <span class=mi>3</span> <span class=o>+</span> <span class=mi>4</span> <span class=p>}</span><span class=p>(</span><span class=p>)</span>

<span class=nx>i</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>c</span>

<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>i</span><span class=p>)</span>
</code></pre></div><p>send被执行前(proceed)通讯(communication)一直被阻塞着。如前所言，无缓存的channel只有在receiver准备好后send才被执行。如果有缓存，并且缓存未满，则send会被执行。</p><p>往一个已经被close的channel中继续发送数据会导致<strong>run-time panic</strong>。</p><p>往nil channel中发送数据会一致被阻塞着。</p><h3 id=receive-操作符>receive 操作符<a href=#receive-操作符 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><hr><p><code>&lt;-ch</code>用来从channel ch中接收数据，这个表达式会一直被block,直到有数据可以接收。</p><p>从一个nil channel中接收数据会一直被block。</p><p>从一个被close的channel中接收数据不会被阻塞，而是立即返回，接收完已发送的数据后会返回元素类型的零值(zero value)。</p><p>如前所述，你可以使用一个额外的返回参数来检查channel是否关闭。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=nx>x</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>ch</span>

<span class=nx>x</span><span class=p>,</span> <span class=nx>ok</span> <span class=p>=</span> <span class=o>&lt;-</span><span class=nx>ch</span>

<span class=kd>var</span> <span class=nx>x</span><span class=p>,</span> <span class=nx>ok</span> <span class=p>=</span> <span class=o>&lt;-</span><span class=nx>ch</span>
</code></pre></div><p>如果OK 是false，表明接收的x是产生的零值，这个channel被关闭了或者为空。</p><h3 id=blocking>blocking<a href=#blocking class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><hr><p>缺省情况下，发送和接收会一直阻塞着，直到另一方准备好。这种方式可以用来在gororutine中进行同步，而不必使用显示的锁或者条件变量。</p><p>如官方的例子中<code>x, y := &lt;-c, &lt;-c</code>这句会一直等待计算结果发送到channel中。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>

<span class=kd>func</span> <span class=nf>sum</span><span class=p>(</span><span class=nx>s</span> <span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>c</span> <span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>

	<span class=nx>sum</span> <span class=o>:=</span> <span class=mi>0</span>

	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>v</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>s</span> <span class=p>{</span>

		<span class=nx>sum</span> <span class=o>+=</span> <span class=nx>v</span>

	<span class=p>}</span>

	<span class=nx>c</span> <span class=o>&lt;-</span> <span class=nx>sum</span> <span class=c1>// send sum to c
</span><span class=c1></span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>main</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>

	<span class=nx>s</span> <span class=o>:=</span> <span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>7</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=o>-</span><span class=mi>9</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>0</span><span class=p>}</span>

	<span class=nx>c</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span>

	<span class=k>go</span> <span class=nf>sum</span><span class=p>(</span><span class=nx>s</span><span class=p>[</span><span class=p>:</span><span class=nb>len</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span><span class=p>]</span><span class=p>,</span> <span class=nx>c</span><span class=p>)</span>

	<span class=k>go</span> <span class=nf>sum</span><span class=p>(</span><span class=nx>s</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span><span class=p>:</span><span class=p>]</span><span class=p>,</span> <span class=nx>c</span><span class=p>)</span>

	<span class=nx>x</span><span class=p>,</span> <span class=nx>y</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>c</span><span class=p>,</span> <span class=o>&lt;-</span><span class=nx>c</span> <span class=c1>// receive from c
</span><span class=c1></span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>x</span><span class=o>+</span><span class=nx>y</span><span class=p>)</span>

<span class=p>}</span>
</code></pre></div><h3 id=buffered-channels>Buffered Channels<a href=#buffered-channels class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><hr><p>make的第二个参数指定缓存的大小：<code>ch := make(chan int, 100)</code>。</p><p>通过缓存的使用，可以尽量避免阻塞，提供应用的性能。</p><h3 id=range>Range<a href=#range class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p><code>for …… range</code>语句可以处理Channel。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=nf>main</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>

	<span class=k>go</span> <span class=kd>func</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>

		<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>1</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Hour</span><span class=p>)</span>

	<span class=p>}</span><span class=p>(</span><span class=p>)</span>

	<span class=nx>c</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span>

	<span class=k>go</span> <span class=kd>func</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>

		<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=nx>i</span> <span class=p>=</span> <span class=nx>i</span> <span class=o>+</span> <span class=mi>1</span> <span class=p>{</span>

			<span class=nx>c</span> <span class=o>&lt;-</span> <span class=nx>i</span>

		<span class=p>}</span>

		<span class=nb>close</span><span class=p>(</span><span class=nx>c</span><span class=p>)</span>

	<span class=p>}</span><span class=p>(</span><span class=p>)</span>

	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>c</span> <span class=p>{</span>

		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>i</span><span class=p>)</span>

	<span class=p>}</span>

	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Finished&#34;</span><span class=p>)</span>

<span class=p>}</span>
</code></pre></div><p><code>range c</code>产生的迭代值为Channel中发送的值，它会一直迭代直到channel被关闭。上面的例子中如果把<code>close(c)</code>注释掉，程序会一直阻塞在<code>for …… range</code>那一行。</p><h3 id=select>select<a href=#select class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><hr><p><code>select</code>语句选择一组可能的send操作和receive操作去处理。它类似<code>switch</code>,但是只是用来处理通讯(communication)操作。<br>它的<code>case</code>可以是send语句，也可以是receive语句，亦或者<code>default</code>。</p><p><code>receive</code>语句可以将值赋值给一个或者两个变量。它必须是一个receive操作。</p><p>最多允许有一个<code>default case</code>,它可以放在case列表的任何位置，尽管我们大部分会将它放在最后。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>

<span class=kd>func</span> <span class=nf>fibonacci</span><span class=p>(</span><span class=nx>c</span><span class=p>,</span> <span class=nx>quit</span> <span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>

	<span class=nx>x</span><span class=p>,</span> <span class=nx>y</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span>

	<span class=k>for</span> <span class=p>{</span>

		<span class=k>select</span> <span class=p>{</span>

		<span class=k>case</span> <span class=nx>c</span> <span class=o>&lt;-</span> <span class=nx>x</span><span class=p>:</span>

			<span class=nx>x</span><span class=p>,</span> <span class=nx>y</span> <span class=p>=</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>x</span><span class=o>+</span><span class=nx>y</span>

		<span class=k>case</span> <span class=o>&lt;-</span><span class=nx>quit</span><span class=p>:</span>

			<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;quit&#34;</span><span class=p>)</span>

			<span class=k>return</span>

		<span class=p>}</span>

	<span class=p>}</span>

<span class=p>}</span>

<span class=kd>func</span> <span class=nf>main</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>

	<span class=nx>c</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span>

	<span class=nx>quit</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span>

	<span class=k>go</span> <span class=kd>func</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>

		<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>

			<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=o>&lt;-</span><span class=nx>c</span><span class=p>)</span>

		<span class=p>}</span>

		<span class=nx>quit</span> <span class=o>&lt;-</span> <span class=mi>0</span>

	<span class=p>}</span><span class=p>(</span><span class=p>)</span>

	<span class=nf>fibonacci</span><span class=p>(</span><span class=nx>c</span><span class=p>,</span> <span class=nx>quit</span><span class=p>)</span>

<span class=p>}</span>
</code></pre></div><p>如果有同时多个case去处理,比如同时有多个channel可以接收数据，那么Go会伪随机的选择一个case处理(pseudo-random)。如果没有case需要处理，则会选择<code>default</code>去处理，如果<code>default case</code>存在的情况下。如果没有<code>default case</code>，则<code>select</code>语句会阻塞，直到某个case需要处理。</p><p>需要注意的是，nil channel上的操作会一直被阻塞，如果没有default case,只有nil channel的select会一直被阻塞。</p><p><code>select</code>语句和<code>switch</code>语句一样，它不是循环，它只会选择一个case来处理，如果想一直处理channel，你可以在外面加一个无限的for循环：</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=k>for</span> <span class=p>{</span>

	<span class=k>select</span> <span class=p>{</span>

	<span class=k>case</span> <span class=nx>c</span> <span class=o>&lt;-</span> <span class=nx>x</span><span class=p>:</span>

		<span class=nx>x</span><span class=p>,</span> <span class=nx>y</span> <span class=p>=</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>x</span><span class=o>+</span><span class=nx>y</span>

	<span class=k>case</span> <span class=o>&lt;-</span><span class=nx>quit</span><span class=p>:</span>

		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;quit&#34;</span><span class=p>)</span>

		<span class=k>return</span>

	<span class=p>}</span>

<span class=p>}</span>
</code></pre></div><h3 id=timeout>timeout<a href=#timeout class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p><code>select</code>有很重要的一个应用就是超时处理。 因为上面我们提到，如果没有case需要处理，select语句就会一直阻塞着。这时候我们可能就需要一个超时操作，用来处理超时的情况。<br>下面这个例子我们会在2秒后往channel c1中发送一个数据，但是<code>select</code>设置为1秒超时,因此我们会打印出<code>timeout 1</code>,而不是<code>result 1</code>。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>import</span> <span class=s>&#34;time&#34;</span>

<span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>

<span class=kd>func</span> <span class=nf>main</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>

    <span class=nx>c1</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>string</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>

    <span class=k>go</span> <span class=kd>func</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>

        <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span>

        <span class=nx>c1</span> <span class=o>&lt;-</span> <span class=s>&#34;result 1&#34;</span>

    <span class=p>}</span><span class=p>(</span><span class=p>)</span>

    <span class=k>select</span> <span class=p>{</span>

    <span class=k>case</span> <span class=nx>res</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>c1</span><span class=p>:</span>

        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>res</span><span class=p>)</span>

    <span class=k>case</span> <span class=o>&lt;-</span><span class=nx>time</span><span class=p>.</span><span class=nf>After</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span> <span class=o>*</span> <span class=mi>1</span><span class=p>)</span><span class=p>:</span>

        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;timeout 1&#34;</span><span class=p>)</span>

    <span class=p>}</span>

<span class=p>}</span>
</code></pre></div><p>其实它利用的是<code>time.After</code>方法，它返回一个类型为<code>&lt;-chan Time</code>的单向的channel，在指定的时间发送一个当前时间给返回的channel中。</p><h3 id=timer和ticker>Timer和Ticker<a href=#timer和ticker class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><hr><p>我们看一下关于时间的两个Channel。<br>timer是一个定时器，代表未来的一个单一事件，你可以告诉timer你要等待多长时间，它提供一个Channel，在将来的那个时间那个Channel提供了一个时间值。下面的例子中第二行会阻塞2秒钟左右的时间，直到时间到了才会继续执行。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=nx>timer1</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>NewTimer</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span>

<span class=o>&lt;-</span><span class=nx>timer1</span><span class=p>.</span><span class=nx>C</span>

<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Timer 1 expired&#34;</span><span class=p>)</span>
</code></pre></div><p>当然如果你只是想单纯的等待的话，可以使用<code>time.Sleep</code>来实现。</p><p>你还可以使用<code>timer.Stop</code>来停止计时器。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=nx>timer2</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>NewTimer</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>

<span class=k>go</span> <span class=kd>func</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>

	<span class=o>&lt;-</span><span class=nx>timer2</span><span class=p>.</span><span class=nx>C</span>

	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Timer 2 expired&#34;</span><span class=p>)</span>

<span class=p>}</span><span class=p>(</span><span class=p>)</span>

<span class=nx>stop2</span> <span class=o>:=</span> <span class=nx>timer2</span><span class=p>.</span><span class=nf>Stop</span><span class=p>(</span><span class=p>)</span>

<span class=k>if</span> <span class=nx>stop2</span> <span class=p>{</span>

	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Timer 2 stopped&#34;</span><span class=p>)</span>

<span class=p>}</span>
</code></pre></div><p><code>ticker</code>是一个定时触发的计时器，它会以一个间隔(interval)往Channel发送一个事件(当前时间)，而Channel的接收者可以以固定的时间间隔从Channel中读取事件。下面的例子中ticker每500毫秒触发一次，你可以观察输出的时间。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=nx>ticker</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>NewTicker</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span> <span class=o>*</span> <span class=mi>500</span><span class=p>)</span>

<span class=k>go</span> <span class=kd>func</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>

	<span class=k>for</span> <span class=nx>t</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>ticker</span><span class=p>.</span><span class=nx>C</span> <span class=p>{</span>

		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Tick at&#34;</span><span class=p>,</span> <span class=nx>t</span><span class=p>)</span>

	<span class=p>}</span>

<span class=p>}</span><span class=p>(</span><span class=p>)</span>
</code></pre></div><p>类似timer, ticker也可以通过<code>Stop</code>方法来停止。一旦它停止，接收者不再会从channel中接收数据了。</p><h3 id=close>close<a href=#close class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><hr><p>内建的close方法可以用来关闭channel。</p><p>总结一下channel关闭后sender的receiver操作。<br>如果channel c已经被关闭,继续往它发送数据会导致<code>panic: send on closed channel</code>:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>import</span> <span class=s>&#34;time&#34;</span>

<span class=kd>func</span> <span class=nf>main</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>

	<span class=k>go</span> <span class=kd>func</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>

		<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Hour</span><span class=p>)</span>

	<span class=p>}</span><span class=p>(</span><span class=p>)</span>

	<span class=nx>c</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>

	<span class=nx>c</span> <span class=o>&lt;-</span> <span class=mi>1</span>

	<span class=nx>c</span> <span class=o>&lt;-</span> <span class=mi>2</span>

	<span class=nb>close</span><span class=p>(</span><span class=nx>c</span><span class=p>)</span>

	<span class=nx>c</span> <span class=o>&lt;-</span> <span class=mi>3</span>

<span class=p>}</span>
</code></pre></div><p>但是从这个关闭的channel中不但可以读取出已发送的数据，还可以不断的读取零值:</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=nx>c</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>

<span class=nx>c</span> <span class=o>&lt;-</span> <span class=mi>1</span>

<span class=nx>c</span> <span class=o>&lt;-</span> <span class=mi>2</span>

<span class=nb>close</span><span class=p>(</span><span class=nx>c</span><span class=p>)</span>

<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=o>&lt;-</span><span class=nx>c</span><span class=p>)</span> <span class=c1>//1
</span><span class=c1></span>
<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=o>&lt;-</span><span class=nx>c</span><span class=p>)</span> <span class=c1>//2
</span><span class=c1></span>
<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=o>&lt;-</span><span class=nx>c</span><span class=p>)</span> <span class=c1>//0
</span><span class=c1></span>
<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=o>&lt;-</span><span class=nx>c</span><span class=p>)</span> <span class=c1>//0
</span></code></pre></div><p>但是如果通过<code>range</code>读取，channel关闭后for循环会跳出：</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=nx>c</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>

<span class=nx>c</span> <span class=o>&lt;-</span> <span class=mi>1</span>

<span class=nx>c</span> <span class=o>&lt;-</span> <span class=mi>2</span>

<span class=nb>close</span><span class=p>(</span><span class=nx>c</span><span class=p>)</span>

<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>c</span> <span class=p>{</span>

	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>i</span><span class=p>)</span>

<span class=p>}</span>
</code></pre></div><p>通过<code>i, ok := &lt;-c</code>可以查看Channel的状态，判断值是零值还是正常读取的值。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=nx>c</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>

<span class=nb>close</span><span class=p>(</span><span class=nx>c</span><span class=p>)</span>

<span class=nx>i</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>c</span>

<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%d, %t&#34;</span><span class=p>,</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>ok</span><span class=p>)</span> <span class=c1>//0, false
</span></code></pre></div><h3 id=同步>同步<a href=#同步 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><hr><p>channel可以用在goroutine之间的同步。<br>下面的例子中main goroutine通过done channel等待worker完成任务。 worker做完任务后只需往channel发送一个数据就可以通知main goroutine任务完成。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>import</span> <span class=p>(</span>

	<span class=s>&#34;fmt&#34;</span>

	<span class=s>&#34;time&#34;</span>

<span class=p>)</span>

<span class=kd>func</span> <span class=nf>worker</span><span class=p>(</span><span class=nx>done</span> <span class=kd>chan</span> <span class=kt>bool</span><span class=p>)</span> <span class=p>{</span>

	<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>

	<span class=c1>// 通知任务已完成
</span><span class=c1></span>
	<span class=nx>done</span> <span class=o>&lt;-</span> <span class=kc>true</span>

<span class=p>}</span>

<span class=kd>func</span> <span class=nf>main</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>

	<span class=nx>done</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>bool</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>

	<span class=k>go</span> <span class=nf>worker</span><span class=p>(</span><span class=nx>done</span><span class=p>)</span>

	<span class=c1>// 等待任务完成
</span><span class=c1></span>
	<span class=o>&lt;-</span><span class=nx>done</span>

<span class=p>}</span>
</code></pre></div><h3 id=官方channels例子>官方Channels例子<a href=#官方channels例子 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>这是从官方摘录的筛选法求素数的 使用channel的经典例子</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=c1>// A concurrent prime sieve
</span><span class=c1></span><span class=kn>package</span> <span class=nx>main</span>

<span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>

<span class=c1>// Send the sequence 2, 3, 4, ... to channel &#39;ch&#39;.
</span><span class=c1></span><span class=kd>func</span> <span class=nf>Generate</span><span class=p>(</span><span class=nx>ch</span> <span class=kd>chan</span><span class=o>&lt;-</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>2</span><span class=p>;</span> <span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=nx>ch</span> <span class=o>&lt;-</span> <span class=nx>i</span> <span class=c1>// Send &#39;i&#39; to channel &#39;ch&#39;.
</span><span class=c1></span>	<span class=p>}</span>
<span class=p>}</span>

<span class=c1>// Copy the values from channel &#39;in&#39; to channel &#39;out&#39;,
</span><span class=c1></span><span class=c1>// removing those divisible by &#39;prime&#39;.
</span><span class=c1></span><span class=kd>func</span> <span class=nf>Filter</span><span class=p>(</span><span class=nx>in</span> <span class=o>&lt;-</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>out</span> <span class=kd>chan</span><span class=o>&lt;-</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>prime</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
	<span class=k>for</span> <span class=p>{</span>
		<span class=nx>i</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>in</span> <span class=c1>// Receive value from &#39;in&#39;.
</span><span class=c1></span>		<span class=k>if</span> <span class=nx>i</span><span class=o>%</span><span class=nx>prime</span> <span class=o>!=</span> <span class=mi>0</span> <span class=p>{</span>
			<span class=nx>out</span> <span class=o>&lt;-</span> <span class=nx>i</span> <span class=c1>// Send &#39;i&#39; to &#39;out&#39;.
</span><span class=c1></span>		<span class=p>}</span>
	<span class=p>}</span>
<span class=p>}</span>

<span class=c1>// The prime sieve: Daisy-chain Filter processes.
</span><span class=c1></span><span class=kd>func</span> <span class=nf>main</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>ch</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span> <span class=c1>// Create a new channel.
</span><span class=c1></span>	<span class=k>go</span> <span class=nf>Generate</span><span class=p>(</span><span class=nx>ch</span><span class=p>)</span>      <span class=c1>// Launch Generate goroutine.
</span><span class=c1></span>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>10000</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=nx>prime</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>ch</span>
		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>prime</span><span class=p>)</span>
		<span class=nx>ch1</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span>
		<span class=k>go</span> <span class=nf>Filter</span><span class=p>(</span><span class=nx>ch</span><span class=p>,</span> <span class=nx>ch1</span><span class=p>,</span> <span class=nx>prime</span><span class=p>)</span>
		<span class=nx>ch</span> <span class=p>=</span> <span class=nx>ch1</span>
	<span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h3 id=参考资料>参考资料<a href=#参考资料 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><hr><ul><li><a href=https://gobyexample.com/channels>https://gobyexample.com/channels</a></li><li><a href=https://tour.golang.org/concurrency/2>https://tour.golang.org/concurrency/2</a></li><li><a href=https://golang.org/ref/spec#Select_statements>https://golang.org/ref/spec#Select_statements</a></li><li><a href=https://github.com/a8m/go-lang-cheat-sheet>https://github.com/a8m/go-lang-cheat-sheet</a></li><li><a href=http://devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-golang/>http://devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-golang/</a></li><li><a href=http://guzalexander.com/2013/12/06/golang-channels-tutorial.html>http://guzalexander.com/2013/12/06/golang-channels-tutorial.html</a></li></ul></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://zzde.me/tags/go>Go</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>3728 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2019-01-13 07:04</p></footer></article><div class="post-nav thin"><a class=next-post href=https://zzde.me/posts/how-to-close-channels-in-golang-elegantly/><span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>&nbsp;Newer</span><br><span>如何优雅的关闭go Channel</span></a>
<a class=prev-post href=https://zzde.me/posts/idempotent-design/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>幂等设计</span></a></div><div id=comments class=thin><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"zzde"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2020 <a href=https://zzde.me/></a>&#183; <a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://zzde.me/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://zzde.me/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-162352798-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>